version: '3.8'

services:
  # FastAPI - ML Prediction Service
  fastapi:
    build: ./backend
    container_name: parkinsons-fastapi
    command: uvicorn api.main:app --host 0.0.0.0 --port 8000 --reload
    ports:
      - "8000:8000"
    volumes:
      - ./backend:/app
      - ./lgb_model_20251211_093754.pkl:/app/model/lgb_model.pkl:ro
      - ./models:/app/model/scalers:ro
    environment:
      - DEBUG=True
      - MODEL_PATH=/app/model/lgb_model.pkl
    networks:
      - parkinsons-network
    restart: unless-stopped

  # Django - User Management Service
  django:
    build: ./backend
    container_name: parkinsons-django
    command: >
      sh -c "python manage.py migrate &&
             python manage.py runserver 0.0.0.0:8001"
    ports:
      - "8001:8001"
    volumes:
      - ./backend:/app
      - django-db:/app/db
    environment:
      - DEBUG=True
      - DJANGO_SETTINGS_MODULE=django_app.settings
    networks:
      - parkinsons-network
    restart: unless-stopped

  # PostgreSQL Database (optional - uncomment for production)
  # postgres:
  #   image: postgres:15-alpine
  #   container_name: parkinsons-postgres
  #   environment:
  #     POSTGRES_USER: parkinsons
  #     POSTGRES_PASSWORD: parkinsons_secret
  #     POSTGRES_DB: parkinsons_db
  #   volumes:
  #     - postgres-data:/var/lib/postgresql/data
  #   ports:
  #     - "5432:5432"
  #   networks:
  #     - parkinsons-network
  #   restart: unless-stopped

networks:
  parkinsons-network:
    driver: bridge

volumes:
  django-db:
  # postgres-data:
